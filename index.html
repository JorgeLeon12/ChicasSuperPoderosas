<!DOCTYPE html>
<html lang="es">
<head>
<title>
    Performance
</title>
</head>


<body>

    <div id=""></div>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript">
	

		var h = 480*1.5;
        var w = 940*1.5;
        var datos = [];
        var actual= [];
        var names= [];
        var length;

       
      

       
         d3.json('target.json', read);

        function read(jsondata) {
        
            for(var i = 0; i < jsondata.teamPerformance.length; i++){
                datos[i] = jsondata.teamPerformance[i].finalTarget;
                actual[i]=jsondata.teamPerformance[i].data[jsondata.teamPerformance[i].data.length-1].amount;
                names[i]=jsondata.teamPerformance[i].name;

            }
            length=jsondata.teamPerformance.length;
            escale();
            


              }



                    
            function escale(){
            var minDataPoint = d3.min(datos);
            var maxDataPoint = d3.max(datos);

            var linearScale = d3.scale.linear()
                .domain([minDataPoint,maxDataPoint])
                .range([minDataPoint/2000,maxDataPoint/2000]);

        
            draw(linearScale);

            }
            

            function draw(linearScale){
            var svg = d3.select("body").append("svg")
            .attr("width", w)
            .attr("height", h);
             svg.append("image")
                    .attr("width", w)
                    .attr("height", h)
                    .attr("xlink:href", "assets/background-mountains.svg");
            svg.append("image")
                    .attr("width", w)
                    .attr("height", h)
                    .attr("xlink:href", "assets/background-sky.svg");
            var newFinalTarget = [];
            var newActual= [];
            var x = 0;
            for(var i = length-1; i >=0; i--){

                newFinalTarget[i] = linearScale(datos[i]);
                newActual[i] = linearScale(actual[i]);
                x+=newFinalTarget[i];
                console.log(x);

            }

            for(var i = length-1; i >=0; i--){

            


               
                
                svg.append("image")
                    .attr("width", newFinalTarget[i]*1.25)
                    .attr("height", newFinalTarget[i])
                    .attr("x", x-newFinalTarget[i])
                    .attr("y", h-newFinalTarget[i])
                    .attr("xlink:href", "assets/green-mountain.svg");



                if (newActual[i]>newFinalTarget[i]){
                    svg.append("image")
                        .attr("width", 60)
                        .attr("height", 84)
                        .attr("x", x+(newFinalTarget[i]*1.25)/2-30-newFinalTarget[i])
                        .attr("y", h-newActual[i]-84)
                        .attr("xlink:href", "assets/balloon.svg");
                }    


                if (newActual[i]==newFinalTarget[i]){
                    svg.append("image")
                        .attr("width", 37.193)
                        .attr("height", 44.126)
                        .attr("x", x+(newFinalTarget[i]*1.25)/2+37.193/40-newFinalTarget[i])
                        .attr("y", h-newFinalTarget[i]-44.126)
                        .attr("xlink:href", "assets/flag-annual-target.svg");
                }

                else{
                    
                    svg.append("image")
                        .attr("width", newFinalTarget[i]*1.25)
                        .attr("height", newFinalTarget[i]-newActual[i])
                        .attr("x", x-newFinalTarget[i])
                        .attr("y", h-newFinalTarget[i])
                        .attr("xlink:href", "assets/mountain.svg");

                    svg.append("image")
                        .attr("width", newFinalTarget[i]*1.25)
                        .attr("height", newFinalTarget[i])
                        .attr("x", x-newFinalTarget[i])
                        .attr("y", h-newFinalTarget[i])
                        .attr("xlink:href", "assets/TransMountain.svg");                    
                }

                
                    
                d3.select("body").append("i").html(names[i])
                .attr("x",x)
                .attr("y",h-newFinalTarget[i]);






                     x -= newFinalTarget[i];
                     console.log(x);
                 }


            }

            
            


      









        
 
    </script>
   

</body>
</html>